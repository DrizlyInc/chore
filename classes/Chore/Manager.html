<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Chore::Manager</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../../css/reset.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/main.css" type="text/css" media="screen" />
<link rel="stylesheet" href="../../css/github.css" type="text/css" media="screen" />
<script src="../../js/jquery-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/jquery-effect.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/main.js" type="text/javascript" charset="utf-8"></script>
<script src="../../js/highlight.pack.js" type="text/javascript" charset="utf-8"></script>

</head>

<body>     
    <div class="banner">
        
        <h1>
            <span class="type">Class</span> 
            Chore::Manager 
            
                <span class="parent">&lt; 
                    
                    <a href="../Object.html">Object</a>
                    
                </span>
            
        </h1>
        <ul class="files">
            
            <li><a href="../../files/lib/chore/manager_rb.html">lib/chore/manager.rb</a></li>
            
        </ul>
    </div>
    <div id="bodyContent">
        <div id="content">
  


  


  
  


  


  
    <!-- Method ref -->
    <div class="sectiontitle">Methods</div>
    <dl class="methods">
      
        <dt>A</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-assign">assign</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>N</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-c-new">new</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>R</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-report">report</a>
              </li>
            
          </ul>
        </dd>
      
        <dt>S</dt>
        <dd>
          <ul>
            
              
              <li>
                <a href="#method-i-shutdown-21">shutdown!</a>,
              </li>
            
              
              <li>
                <a href="#method-i-start">start</a>
              </li>
            
          </ul>
        </dd>
      
    </dl>
  

  



  

    

    

    


    


    <!-- Methods -->
    
      <div class="sectiontitle">Class Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-c-new">
            
              <b>new</b>()
            
            <a href="../../classes/Chore/Manager.html#method-c-new" name="method-c-new" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-c-new_source')" id="l_method-c-new_source">show</a>
                
              </p>
              <div id="method-c-new_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">initialize</span>()
  <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Booting Chore #{Chore::VERSION}&quot;</span>
  <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">inspect</span> }
  <span class="ruby-ivar">@started_at</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@worker_strategy</span> = <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">worker_strategy</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@fetcher</span> = <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">fetcher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@processed</span> = <span class="ruby-number">0</span>
  <span class="ruby-ivar">@stopping</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                  
      <div class="sectiontitle">Instance Public methods</div>
      
        <div class="method">
          <div class="title method-title" id="method-i-assign">
            
              <b>assign</b>(work)
            
            <a href="../../classes/Chore/Manager.html#method-i-assign" name="method-i-assign" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Take in an amount of <code>work</code> (either an Array of, or a single <a
href="UnitOfWork.html">UnitOfWork</a>), and pass it down for the worker
strategy to process. <strong>This method is blocking</strong>. It will
continue to attempt to assign the work via the worker strategy, until it
accepts it. It is up to the strategy to determine what cases it is allowed
to accept work. The blocking semantic of this method is to prevent the
Fetcher from getting messages off of the queue faster  than they can be
consumed.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-assign_source')" id="l_method-i-assign_source">show</a>
                
              </p>
              <div id="method-i-assign_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">assign</span>(<span class="ruby-identifier">work</span>)
  <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;Manager#assign(#{work.inspect})&quot;</span> }
  <span class="ruby-identifier">assigned</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">until</span> <span class="ruby-identifier">assigned</span> 
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@stopping</span>
    <span class="ruby-identifier">assigned</span> = <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">assign</span>(<span class="ruby-identifier">work</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">assigned</span>
      <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">stats</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:batches</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">sleep</span>(<span class="ruby-number">0.2</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-report">
            
              <b>report</b>()
            
            <a href="../../classes/Chore/Manager.html#method-i-report" name="method-i-report" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Generate data for the internal <a href="../Chore.html">Chore</a> stat
server. Should return JSON data representing the current state of the 
process. The default data set is:</p>
<ul><li>
<p><code>master_started_at</code>: the timestamp of when the <a
href="../Chore.html">Chore</a> process started up</p>
</li><li>
<p><code>queues</code>: the list of queues this process is configured to
consume</p>
</li><li>
<p><code>active_workers</code>: an array of <a
href="Worker.html">Chore::Worker</a> objects (will pass through a call to
to_json)</p>
</li><li>
<p><code>stats</code>: the data inside of <a
href="../Chore.html#attribute-c-stats">Chore.stats</a>. This will include
recently processed jobs, and other data that may be</p>
</li></ul>

<p>used to do some simple per-server graphing.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-report_source')" id="l_method-i-report_source">show</a>
                
              </p>
              <div id="method-i-report_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">report</span>
  {
    <span class="ruby-string">'master_started_at'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@started_at</span>.<span class="ruby-identifier">to_i</span>, 
    <span class="ruby-string">'queues'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">queues</span>,
    <span class="ruby-string">'active_workers'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">workers</span>,
    <span class="ruby-string">'stats'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">stats</span>
  }.<span class="ruby-identifier">to_json</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-shutdown-21">
            
              <b>shutdown!</b>()
            
            <a href="../../classes/Chore/Manager.html#method-i-shutdown-21" name="method-i-shutdown-21" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Shut down the <a href="Manager.html">Manager</a>, the <a
href="Worker.html">Worker</a> Strategy, and the Fetcher. This calls the
<code>:before_shutdown</code> hook.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-shutdown-21_source')" id="l_method-i-shutdown-21_source">show</a>
                
              </p>
              <div id="method-i-shutdown-21_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">shutdown!</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@stopping</span>
    <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Manager shutting down&quot;</span>
    <span class="ruby-ivar">@stopping</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">run_hooks_for</span>(<span class="ruby-value">:before_shutdown</span>)
    <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">stop!</span>
    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">stop!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
        
        <div class="method">
          <div class="title method-title" id="method-i-start">
            
              <b>start</b>()
            
            <a href="../../classes/Chore/Manager.html#method-i-start" name="method-i-start" class="permalink">Link</a>
          </div>
          
          
            <div class="description">
              <p>Start the <a href="Manager.html">Manager</a>. This calls both the <a
href="Manager.html#method-i-start">start</a> method of the configured <a
href="Worker.html">Worker</a> Strategy, as well as Fetcher#start.</p>
            </div>
          
          
          
          
          
            
            <div class="sourcecode">
              
              <p class="source-link">
                Source: 
                <a href="javascript:toggleSource('method-i-start_source')" id="l_method-i-start_source">show</a>
                
              </p>
              <div id="method-i-start_source" class="dyn-source">
                <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword ruby-title">start</span>
  <span class="ruby-ivar">@started_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">start</span>
  <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">start</span>
<span class="ruby-keyword">end</span></pre>
              </div>
            </div>
            
          </div>
                    </div>

    </div>
  </body>
</html>    
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Chore::Manager
  
    &mdash; Documentation by YARD 0.8.6.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Chore.html" title="Chore (module)">Chore</a></span></span>
     &raquo; 
    <span class="title">Manager</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Chore::Manager
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Chore::Manager</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">lib/chore/manager.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#assign-instance_method" title="#assign (instance method)">- (Object) <strong>assign</strong>(work) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Take in an amount of <code>work</code> (either an Array of, or a single
UnitOfWork), and pass it down for the worker strategy to process.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Manager) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A new instance of Manager.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#report-instance_method" title="#report (instance method)">- (Object) <strong>report</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate data for the internal Chore stat server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shutdown%21-instance_method" title="#shutdown! (instance method)">- (Object) <strong>shutdown!</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shut down the Manager, the Worker Strategy, and the Fetcher.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">- (Object) <strong>start</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Start the Manager.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Chore::Manager (class)">Manager</a></span></tt>) <strong>initialize</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A new instance of Manager</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8
9
10
11
12
13
14
15
16</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/chore/manager.rb', line 8</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='rparen'>)</span>
  <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Booting Chore </span><span class='embexpr_beg'>#{</span><span class='const'>Chore</span><span class='op'>::</span><span class='const'>VERSION</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span> <span class='rbrace'>}</span>
  <span class='ivar'>@started_at</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@worker_strategy</span> <span class='op'>=</span> <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_worker_strategy'>worker_strategy</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='ivar'>@fetcher</span> <span class='op'>=</span> <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_fetcher'>fetcher</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='rparen'>)</span>
  <span class='ivar'>@processed</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@stopping</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="assign-instance_method">
  
    - (<tt>Object</tt>) <strong>assign</strong>(work) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Take in an amount of <code>work</code> (either an Array of, or a single
UnitOfWork), and pass it down for the worker strategy to process.
<strong>This method is blocking</strong>. It will continue to attempt to
assign the work via the worker strategy, until it accepts it. It is up to
the strategy to determine what cases it is allowed to accept work. The
blocking semantic of this method is to prevent the Fetcher from getting
messages off of the queue faster  than they can be consumed.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54
55
56
57
58
59</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/chore/manager.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_assign'>assign</span><span class='lparen'>(</span><span class='id identifier rubyid_work'>work</span><span class='rparen'>)</span>
  <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_debug'>debug</span> <span class='lbrace'>{</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Manager#assign(</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_work'>work</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_assigned'>assigned</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>until</span> <span class='id identifier rubyid_assigned'>assigned</span> 
    <span class='kw'>break</span> <span class='kw'>if</span> <span class='ivar'>@stopping</span>
    <span class='id identifier rubyid_assigned'>assigned</span> <span class='op'>=</span> <span class='ivar'>@worker_strategy</span><span class='period'>.</span><span class='id identifier rubyid_assign'>assign</span><span class='lparen'>(</span><span class='id identifier rubyid_work'>work</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_assigned'>assigned</span>
      <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='symbol'>:batches</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.2</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="report-instance_method">
  
    - (<tt>Object</tt>) <strong>report</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate data for the internal Chore stat server. Should return JSON data
representing the current state of the  process. The default data set is:</p>
<ul><li>
<p><code>master_started_at</code>: the timestamp of when the Chore process
started up</p>
</li><li>
<p><code>queues</code>: the list of queues this process is configured to
consume</p>
</li><li>
<p><code>active_workers</code>: an array of Chore::Worker objects (will pass
through a call to to_json)</p>
</li><li>
<p><code>stats</code>: the data inside of Chore.stats. This will include
recently processed jobs, and other data that may be</p>
</li></ul>

<p>used to do some simple per-server graphing.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72
73
74
75
76
77</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/chore/manager.rb', line 70</span>

<span class='kw'>def</span> <span class='id identifier rubyid_report'>report</span>
  <span class='lbrace'>{</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>master_started_at</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@started_at</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='comma'>,</span> 
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>queues</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='period'>.</span><span class='id identifier rubyid_queues'>queues</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>active_workers</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='ivar'>@worker_strategy</span><span class='period'>.</span><span class='id identifier rubyid_workers'>workers</span><span class='comma'>,</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>stats</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_to_json'>to_json</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shutdown!-instance_method">
  
    - (<tt>Object</tt>) <strong>shutdown!</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shut down the Manager, the Worker Strategy, and the Fetcher. This calls the
<code>:before_shutdown</code> hook.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


30
31
32
33
34
35
36
37
38</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/chore/manager.rb', line 30</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shutdown!'>shutdown!</span>
  <span class='kw'>unless</span> <span class='ivar'>@stopping</span>
    <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Manager shutting down</span><span class='tstring_end'>&quot;</span></span>
    <span class='ivar'>@stopping</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='const'>Chore</span><span class='period'>.</span><span class='id identifier rubyid_run_hooks_for'>run_hooks_for</span><span class='lparen'>(</span><span class='symbol'>:before_shutdown</span><span class='rparen'>)</span>
    <span class='ivar'>@worker_strategy</span><span class='period'>.</span><span class='id identifier rubyid_stop!'>stop!</span>
    <span class='ivar'>@fetcher</span><span class='period'>.</span><span class='id identifier rubyid_stop!'>stop!</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-instance_method">
  
    - (<tt>Object</tt>) <strong>start</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Start the Manager. This calls both the #start method of the configured
Worker Strategy, as well as Fetcher#start.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


21
22
23
24
25</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/chore/manager.rb', line 21</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
  <span class='ivar'>@started_at</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span>
  <span class='ivar'>@worker_strategy</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
  <span class='ivar'>@fetcher</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon May  6 15:57:17 2013 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.6.1 (ruby-1.9.3).
</div>

  </body>
</html>
<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class Chore::Manager - chore </title>

<link type="text/css" media="screen" href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../index.html">Home</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/chore/manager.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="../Object.html">Object</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-assign">#assign</a>
    
    <li><a href="#method-i-report">#report</a>
    
    <li><a href="#method-i-shutdown-21">#shutdown!</a>
    
    <li><a href="#method-i-start">#start</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../Chore.html">Chore</a>
  
    <li><a href="../Chore/CLI.html">Chore::CLI</a>
  
    <li><a href="../Chore/Configuration.html">Chore::Configuration</a>
  
    <li><a href="../Chore/Consumer.html">Chore::Consumer</a>
  
    <li><a href="../Chore/DuplicateDetector.html">Chore::DuplicateDetector</a>
  
    <li><a href="../Chore/FilesystemConsumer.html">Chore::FilesystemConsumer</a>
  
    <li><a href="../Chore/FilesystemPublisher.html">Chore::FilesystemPublisher</a>
  
    <li><a href="../Chore/FilesystemQueue.html">Chore::FilesystemQueue</a>
  
    <li><a href="../Chore/ForkedWorkerStrategy.html">Chore::ForkedWorkerStrategy</a>
  
    <li><a href="../Chore/Hooks.html">Chore::Hooks</a>
  
    <li><a href="../Chore/Job.html">Chore::Job</a>
  
    <li><a href="../Chore/Job/ClassMethods.html">Chore::Job::ClassMethods</a>
  
    <li><a href="../Chore/Job/RejectMessageException.html">Chore::Job::RejectMessageException</a>
  
    <li><a href="../Chore/JsonEncoder.html">Chore::JsonEncoder</a>
  
    <li><a href="../Chore/Lease.html">Chore::Lease</a>
  
    <li><a href="../Chore/LockingSQSConsumer.html">Chore::LockingSQSConsumer</a>
  
    <li><a href="../Chore/Manager.html">Chore::Manager</a>
  
    <li><a href="../Chore/Pipe.html">Chore::Pipe</a>
  
    <li><a href="../Chore/PipeListener.html">Chore::PipeListener</a>
  
    <li><a href="../Chore/PipedStats.html">Chore::PipedStats</a>
  
    <li><a href="../Chore/Publisher.html">Chore::Publisher</a>
  
    <li><a href="../Chore/SQSConsumer.html">Chore::SQSConsumer</a>
  
    <li><a href="../Chore/SQSPublisher.html">Chore::SQSPublisher</a>
  
    <li><a href="../Chore/Semaphore.html">Chore::Semaphore</a>
  
    <li><a href="../Chore/SingleConsumerStrategy.html">Chore::SingleConsumerStrategy</a>
  
    <li><a href="../Chore/SingleWorkerStrategy.html">Chore::SingleWorkerStrategy</a>
  
    <li><a href="../Chore/Stats.html">Chore::Stats</a>
  
    <li><a href="../Chore/Tapjoy.html">Chore::Tapjoy</a>
  
    <li><a href="../Chore/ThreadedConsumerStrategy.html">Chore::ThreadedConsumerStrategy</a>
  
    <li><a href="../Chore/UnitOfWork.html">Chore::UnitOfWork</a>
  
    <li><a href="../Chore/Util.html">Chore::Util</a>
  
    <li><a href="../Chore/Version.html">Chore::Version</a>
  
    <li><a href="../Chore/Worker.html">Chore::Worker</a>
  
    <li><a href="../Chore/WorkerListener.html">Chore::WorkerListener</a>
  
    <li><a href="../NewRelic.html">NewRelic</a>
  
    <li><a href="../NewRelic/Agent.html">NewRelic::Agent</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation.html">NewRelic::Agent::Instrumentation</a>
  
    <li><a href="../NewRelic/Agent/Instrumentation/ChoreInstrumentHook.html">NewRelic::Agent::Instrumentation::ChoreInstrumentHook</a>
  
    <li><a href="../Object.html">Object</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class Chore::Manager</h1>

  <div id="description" class="description">
    
  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 8</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>()
  <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-node">&quot;Booting Chore #{Chore::VERSION}&quot;</span>
  <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">inspect</span> }
  <span class="ruby-ivar">@started_at</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@worker_strategy</span> = <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">worker_strategy</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@fetcher</span> = <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">fetcher</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword">self</span>)
  <span class="ruby-ivar">@processed</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@stopping</span> = <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-assign" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">assign</span><span
            class="method-args">(work)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Take in an amount of <code>work</code> (either an Array of, or a single <a
href="UnitOfWork.html">UnitOfWork</a>), and pass it down for the worker
strategy to process. <strong>This method is blocking</strong>. It will
continue to attempt to assign the work via the worker strategy, until it
accepts it. It is up to the strategy to determine what cases it is allowed
to accept work. The blocking semantic of this method is to prevent the
Fetcher from getting messages off of the queue faster  than they can be
consumed.</p>
          

          
          <div class="method-source-code" id="assign-source">
            <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">assign</span>(<span class="ruby-identifier">work</span>)
  <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;Manager#assign(#{work.inspect})&quot;</span> }
  <span class="ruby-identifier">assigned</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">until</span> <span class="ruby-identifier">assigned</span> 
    <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@stopping</span>
    <span class="ruby-identifier">assigned</span> = <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">assign</span>(<span class="ruby-identifier">work</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">assigned</span>
      <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">stats</span>.<span class="ruby-identifier">add</span>(<span class="ruby-value">:batches</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">sleep</span>(<span class="ruby-value">0.2</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- assign-source -->
          
        </div>

        

        
      </div><!-- assign-method -->

    
      <div id="method-i-report" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">report</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Generate data for the internal <a href="../Chore.html">Chore</a> stat
server. Should return JSON data representing the current state of the 
process. The default data set is:</p>
<ul><li>
<p><code>master_started_at</code>: the timestamp of when the <a
href="../Chore.html">Chore</a> process started up</p>
</li><li>
<p><code>queues</code>: the list of queues this process is configured to
consume</p>
</li><li>
<p><code>active_workers</code>: an array of <a
href="Worker.html">Chore::Worker</a> objects (will pass through a call to
to_json)</p>
</li><li>
<p><code>stats</code>: the data inside of <a
href="../Chore.html#attribute-c-stats">Chore.stats</a>. This will include
recently processed jobs, and other data that may be</p>
</li></ul>

<p>used to do some simple per-server graphing.</p>
          

          
          <div class="method-source-code" id="report-source">
            <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 70</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">report</span>
  {
    <span class="ruby-string">'master_started_at'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@started_at</span>.<span class="ruby-identifier">to_i</span>, 
    <span class="ruby-string">'queues'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">config</span>.<span class="ruby-identifier">queues</span>,
    <span class="ruby-string">'active_workers'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">workers</span>,
    <span class="ruby-string">'stats'</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">stats</span>
  }.<span class="ruby-identifier">to_json</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- report-source -->
          
        </div>

        

        
      </div><!-- report-method -->

    
      <div id="method-i-shutdown-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shutdown!</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Shut down the <a href="Manager.html">Manager</a>, the <a
href="Worker.html">Worker</a> Strategy, and the Fetcher. This calls the
<code>:before_shutdown</code> hook.</p>
          

          
          <div class="method-source-code" id="shutdown-21-source">
            <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 30</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shutdown!</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@stopping</span>
    <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">logger</span>.<span class="ruby-identifier">info</span> <span class="ruby-string">&quot;Manager shutting down&quot;</span>
    <span class="ruby-ivar">@stopping</span> = <span class="ruby-keyword">true</span>
    <span class="ruby-constant">Chore</span>.<span class="ruby-identifier">run_hooks_for</span>(<span class="ruby-value">:before_shutdown</span>)
    <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">stop!</span>
    <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">stop!</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- shutdown-21-source -->
          
        </div>

        

        
      </div><!-- shutdown-21-method -->

    
      <div id="method-i-start" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">start</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Start the <a href="Manager.html">Manager</a>. This calls both the <a
href="Manager.html#method-i-start">start</a> method of the configured <a
href="Worker.html">Worker</a> Strategy, as well as Fetcher#start.</p>
          

          
          <div class="method-source-code" id="start-source">
            <pre><span class="ruby-comment"># File lib/chore/manager.rb, line 21</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">start</span>
  <span class="ruby-ivar">@started_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-ivar">@worker_strategy</span>.<span class="ruby-identifier">start</span>
  <span class="ruby-ivar">@fetcher</span>.<span class="ruby-identifier">start</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- start-source -->
          
        </div>

        

        
      </div><!-- start-method -->

    
    </section><!-- public-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

